# 스핀락, 뮤텍스, 세마포어

Created Time: October 19, 2022 11:30 PM
Status: 🛠 In Progress

## 어떻게 Mutual Exclusion을 보장할 수 있을까?

락(lock)을 사용하자

```java
do {

	acquire lock
		critical section
	release lock
		remainder section

} while (true)
```

여러 프로세스/쓰레드가 락을 획득하기 위해서 경합을 하게 되는데, 그 중 성공한 하나의 프로세스/쓰레드가 `critical section`에 들어가서 실행을 하게 된다.

해당 작업이 끝나면 `critical section`을 빠져나오면서 락을 반환한다.

```c
volatile int lock = 0; // global

int test_and_set(int* lockPtr);

void critical() {
	while (test_and_set(&lock) == 1);

	... critical section

	lock = 0;
}

int test_and_set(int* lockPtr) {
	int oldLock = *lockPtr;
	*lockPtr = 1;
	return oldLock;
}
```

2개의 쓰레드 T1, T2가 있다고 가정하고, critical()을 실행한다.

`while (test_and_set(&lock) == 1);` T1이 실행 후 `lock`이 1이 된 후 0을 리턴하여 `critical section`에 진입한다.