# 컨텍스트 스위칭

Created Time: October 12, 2022 11:21 PM

# 컨텍스트 스위칭(Context Switching)

CPU/코어에서 실행 중이던 프로세스/쓰레드가 다른 프로세스/쓰레드로 교체되는 것.

(요즘 프로세스는 최소 하나 이상의 쓰레드를 갖고 있음. 그래서 요즘 스위칭이 되면 다른 프로세스의 쓰레드로 교체가 되는 느낌)

## 여기서 말하는 컨텍스트(Context)는?

프로세스/스레드의 상태

CPU(Registers, PC), 메모리 등

## 왜 컨텍스트 스위칭이 필요한가?

여러 프로세스/쓰레드를 동시에 실행시키기 위해서

## 컨텍스트 스위칭은 언제 발생하는가?

주어진 Time Slice(Quantum)를 프로세스/쓰레드가 다 사용했거나, I/O작업을 해야하거나, 다른 프로세스/쓰레드에서 이미 사용하고 있는 리소스를 기다려야 하거나 (인터럽트) 등등

## 컨텍스트 스위칭은 누구에 의해 실행되는가?

OS 커널(kernel) [운영체제에서도 가장 핵심적인 기능을 담당하는 존재]

(각종 레지스터,메모리  리소스를 관리/감독하는 역할)

컨텍스트 스위칭은 OS 커널이 통제권을 가지고 집행/실행함

## 컨텍스트 스위칭은 구체적으로 어떤 과정으로 일어나는가?

다른 프로세스끼리 스위칭인지(프로세스 컨텍스트 스위칭), 같은 프로세스의 스레드들끼리 스위칭인지(쓰레드 컨텍스트 스위칭)에 따라 다르다.

### 프로세스, 쓰레드 컨텍스트 스위칭… 둘의 공통점은?

1. OS커널 모드에서 실행
2. CPU의 레지스터 상태를 교체

### 둘의 차이점은?

- 같은 프로세스에 있는 쓰레드들 끼리의 컨텍스트 스위칭은 같은 프로세스에 속하기 때문에 그 메모리의 영역을 공유를 하여, 스위칭이  일어나도 메모리 관련하여 관리할 필요가 없다.
- 다른 프로세스의 속하는 쓰레드들끼리의 컨텍스트 스위칭이 일어날 때(프로세스끼리의 컨텍스트 스위칭이 일어날때) 메모리 주소 체계가 다르기 때문에 **가상 메모리 주소 관련 처리**를 추가로 수행해야한다.

(MMU, TLB[가상 메모리 주소와 실제 메모리 주소의 매핑하는 캐시] 관리)

Memory Management Unit이 해당 프로세스를 바라보게 연결, TLB는 비워버림

### 그래서 쓰레드 컨텍스트 스위칭이 더 빠른 이유?

**메모리 주소 관련 처리**는 하지 않기 때문이다.

## 컨텍스트 스위칭이 미치는 간접적인 영향?

캐시 오염(Cache Pollution)

자주 쓸 것 같은 데이터를 캐시에 저장하는 방식인데, 프로세스 컨텍스트 스위칭시 서로 다른 데이터를 사용할 확률이 높기 때문에 이 캐쉬에 있는 값들이 오염이 됐다고 한다.(컨텍스트 스위칭시 이전 프로세스가 이용하던 데이터와 다른 데이터이기 때문에 캐쉬에 접근해도 의미가 없다!!)

그나마 쓰레드 컨텍스트 스위칭이면 확률적으로 같은 데이터를 공유하여 사용할 확률은 높다.

어떤 CPU 아키텍쳐는 컨텍스트 스위칭시 캐쉬를 비우는 아키텍쳐도 있다.

## 유저 관점에서 컨텍스트 스위칭이란?

순수한 오버헤드 (Pure Overhead)

내가 실행한 프로그램의 동작과는 무관한 동작 비용이 일어난다!!
