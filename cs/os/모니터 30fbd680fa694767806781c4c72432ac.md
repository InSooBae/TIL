# 모니터

Created Time: October 29, 2022 2:51 PM
Status: 🛠 In Progress

## 모니터(Monitor)

- mutual exclusion을 보장
- 조건에 따라 쓰레드가 대기(waiting)상태로 전환 기능

### 모니터.. 언제 사용되나?

- 한번에 하나의 쓰레드만 실행돼야 할 때
- 여러 쓰레드와 협업(cooperation)이 필요할  때

### 모니터의 구성 요소

- mutex
    - critical section에서 mutual exclusion을 보장하는 장치
    - critical section에 진입하려면 mutex lock을 취득해야함
    - mutex lock을 취득하지 못한 쓰레드는 큐에 들어간 후 대기(waiting)상태로 전환
    - mutex lock을 쥔 쓰레드가 lock을 반환하면 락을 기다리며 큐에 대기상태로 있던 쓰레드 중 하나가 실행
- condition variable(s) → CV
    - waiting queue를 가짐
        - 조건이 충족되길 기다리는 쓰레드들이 대기 상태로 머무는 곳
    - wait
        - 쓰레드가 자기 자신을 CV의 waiting queue에 넣고 대기 상태로 전환
    - signal
        - waiting queue에서 대기중인 쓰레드 중 하나를 깨움
    - broadcast
        - waiting queue에서 대기중인 쓰레드 전부를 깨움

## 모니터 동작 방식

### 모니터 뼈대 코드

```cpp
acquire(m); // 모니터 락 취득

while (!p) { // 조건 확인
	wait(m, cv); // 조건 충족 안되면 waiting
}

...

signal(cv); -- or -- broadcast(cv2); // cv2rk cv와 같을 수 있음

release(m); // 모니터 락 반환
```